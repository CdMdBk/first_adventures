var __extends=this&&this.__extends||function(){var s=function(t,e){return(s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();import{backpack,ctx,camera}from"../variables/variables.js";import{TemplateCell}from"./template.js";import{field}from"../variables/variables.js";import{keys}from"../variables/variables.js";import{Player,player}from"./player.js";import{objAudio}from"../variables/list-audio.js";var NPC=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.frame=0,t.numberOfFrames=27,t}return __extends(t,e),t}(TemplateCell),Interlocutor=function(c){function t(t,e,i,s,a,r,n,h,o){t=c.call(this,t,e,i)||this;return t.phrases=[],t.image=new Image,t.width=t.size,t.height=s,t.heightImage=o,t.startX=t.x-5,t.startY=t.y-5,t.name=a,t.stageOfConversation=r,t.phrases=n,t.image.src=h,t.frame=0,t.numberOfFrames=9,t}return __extends(t,c),t.prototype.draw=function(){ctx.drawImage(this.image,196*this.frame+1,0,195,this.heightImage,this.x,this.y,this.width+5,this.height+5)},t.prototype.changePositions=function(){this.x=this.startX+(camera.currentPosition.startX-camera.currentPosition.x),this.y=this.startY+(camera.currentPosition.startY-camera.currentPosition.y),this.draw(),player.numberOfCompletedFrames%24==0&&this.frame++,this.frame>=this.numberOfFrames&&(this.frame=0)},t.prototype.showHint=function(){keys.f.pause||(ctx.fillStyle="rgba(0,0,0,.5)",ctx.fillRect(this.x-1.5*this.width,this.y-.75*this.width,4*this.width,this.width/2),ctx.fillStyle="white",ctx.font="900 ".concat(field.sizeCell/13,"px Pixel Art"),ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillText('жмякни "а", чтобы поболтать',this.x+this.width/2,this.y-this.width/2))},t.prototype.startDialog=function(){!keys.f.pressed||keys.f.pause||backpack.classList.contains("backpack_active")||(this.phrases[this.stageOfConversation].play(),keys.f.pause=!0,player.thinks=!0,player.audio.laLaLa.currentTime=0,player.audio.laLaLa.pause(),this.phrases[this.stageOfConversation].addEventListener("ended",this.endDialog),keys.f.pause||this.phrases[this.stageOfConversation].removeEventListener("ended",this.endDialog),this.stageOfConversation<this.phrases.length-1?(this.stageOfConversation++,player.stageOfConversation[this.name]++):player.playerTasks.completedDialogues[this.name]=!0)},t.prototype.endDialog=function(){keys.f.pause=!1,backpack.classList.contains("backpack_active")||(player.thinks=!1)},t}(NPC),Wounded=function(l){function t(t,e,i,s,a,r,n,h,o,c){t=l.call(this,t,e,i)||this;return t.phrases=[],t.textHint="вылечить девушку",t.image={woundedCondition:new Image,healthyCondition:new Image},t.condition="wounded",t.healingProcess=!1,t.stageOfConversation=0,t.width=t.size,t.height=s,t.widthImage=n,t.heightImage=h,t.startX=t.x-5,t.startY=t.y-5,t.name=a,t.phrases=r,t.healingProcess=o,t.stageOfConversation=c,t.image.woundedCondition.src="./images/characters/wounded.png",t.image.healthyCondition.src="./images/characters/healthy.png",t.frame=0,t.numberOfFrames=8,t}return __extends(t,l),t.prototype.draw=function(){switch(this.condition){case"wounded":ctx.drawImage(this.image.woundedCondition,this.frame*this.widthImage+1,0,this.widthImage-1,this.heightImage,this.x,this.y,this.width+5,this.height+5);break;case"healthy":ctx.drawImage(this.image.healthyCondition,this.frame*this.widthImage+1,0,this.widthImage,this.heightImage,this.x,this.y,this.width+5,this.height+5)}},t.prototype.changePositions=function(){this.healingProcess&&(this.textHint='жмякни "а", чтобы поговорить'),this.healingProcess&&"wounded"===this.condition&&"heals"!==player.action&&(this.condition="healthy",this.frame=0,this.numberOfFrames=9,player.thinks=!1,keys.f.pause=!1),this.x=this.startX+(camera.currentPosition.startX-camera.currentPosition.x),this.y=this.startY+(camera.currentPosition.startY-camera.currentPosition.y),this.draw(),this.frame>=this.numberOfFrames&&(this.frame=0)},t.prototype.showHint=function(){keys.f.pause||(ctx.fillStyle="rgba(0,0,0,.5)",ctx.fillRect(this.x-1.5*this.width,this.y-.75*this.width,4*this.width,this.width/2),ctx.fillStyle="white",ctx.font="900 ".concat(field.sizeCell/13,"px Pixel Art"),ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillText(this.textHint,this.x+this.width/2,this.y-this.width/2))},t.prototype.heals=function(){!keys.f.pressed||keys.f.pause||"wounded"!==this.condition||backpack.classList.contains("backpack_active")||(player.debuffSpeed=.5,Player.speed*=player.debuffSpeed,player.playerTasks.completedDialogues[this.name]=!0,player.frame=0,player.action="heals",player.thinks=!0,keys.f.pause=!0,this.healingProcess=!0)},t.prototype.startDialog=function(){!keys.f.pressed||keys.f.pause||"healthy"!==this.condition||backpack.classList.contains("backpack_active")||(this.phrases[this.stageOfConversation].play(),keys.f.pause=!0,player.thinks=!0,this.phrases[this.stageOfConversation].addEventListener("ended",this.endDialog),keys.f.pause||this.phrases[this.stageOfConversation].removeEventListener("ended",this.endDialog),this.stageOfConversation<this.phrases.length-1&&(this.stageOfConversation++,player.stageOfConversation[this.name]++))},t.prototype.endDialog=function(){keys.f.pause=!1,player.thinks=!1,backpack.classList.contains("backpack_active")||(player.thinks=!1)},t}(NPC),Lera=function(c){function t(t,e,i,s,a,r,n,h,o){t=c.call(this,t,e,i)||this;return t.phrases=[],t.outrageAudioArray=objAudio.outrage,t.textHint='жмякни "а", чтобы поболтать',t.image={stateOfRest:new Image,gettingHit:new Image},t.action="worth",t.width=t.size,t.height=s,t.widthImage=h,t.heightImage=o,t.startX=t.x-5,t.startY=t.y-5,t.name=a,t.stageOfConversation=r,t.phrases=n,t.image.stateOfRest.src="./images/characters/lera-state.png",t.image.gettingHit.src="./images/characters/lera-getting-hit.png",t.frame=0,t.numberOfFrames=9,t}return __extends(t,c),t.prototype.draw=function(){switch(this.action){case"worth":ctx.drawImage(this.image.stateOfRest,this.frame*this.widthImage+1,0,this.widthImage-1,this.heightImage,this.x,this.y,this.width+5,this.height+5);break;case"getting hit":ctx.drawImage(this.image.gettingHit,this.frame*this.widthImage+1,0,this.widthImage,this.heightImage,this.x,this.y,this.width+5,this.height+5)}},t.prototype.changePositions=function(){this.x=this.startX+(camera.currentPosition.startX-camera.currentPosition.x),this.y=this.startY+(camera.currentPosition.startY-camera.currentPosition.y),this.draw(),"worth"===this.action&&player.numberOfCompletedFrames%24==0&&this.frame++,"getting hit"===this.action&&player.numberOfCompletedFrames%12==0&&this.frame++,10===this.frame&&(this.action="worth",this.numberOfFrames=9),this.frame>=this.numberOfFrames&&(this.frame=0)},t.prototype.showHint=function(){keys.f.pause||(ctx.fillStyle="rgba(0,0,0,.5)",ctx.fillRect(this.x-1.5*this.width,this.y-.75*this.width,4*this.width,this.width/2),ctx.fillStyle="white",ctx.font="900 ".concat(field.sizeCell/13,"px Pixel Art"),ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillText(this.textHint,this.x+this.width/2,this.y-this.width/2))},t.prototype.startDialog=function(){keys.f.pressed&&!keys.f.pause&&this.stageOfConversation<this.phrases.length&&!backpack.classList.contains("backpack_active")&&(this.phrases[this.stageOfConversation].play(),keys.f.pause=!0,player.thinks=!0,player.audio.la.currentTime=0,player.audio.la.pause(),this.phrases[this.stageOfConversation].addEventListener("ended",this.endDialog),keys.f.pause||this.phrases[this.stageOfConversation].removeEventListener("ended",this.endDialog),this.stageOfConversation++,player.stageOfConversation[this.name]++)},t.prototype.endDialog=function(){keys.f.pause=!1,backpack.classList.contains("backpack_active")||(player.thinks=!1)},t.prototype.gettingHit=function(){this.stageOfConversation>=this.phrases.length&&(this.textHint="пни её уже!"),keys.f.pressed&&!keys.f.pause&&!player.thinks&&this.stageOfConversation>=this.phrases.length&&!backpack.classList.contains("backpack_active")&&(player.audio.la.currentTime=0,player.audio.la.pause(),player.thinks=!0,keys.f.pause=!0,this.action="getting hit",this.frame=0,this.numberOfFrames=10,player.playerTasks.completedDialogues[this.name]=!0,player.frame=0,player.action="beats",objAudio.player[9].currentTime=0,objAudio.player[9].play(),this.outrageAudioArray.forEach(function(t){t.currentTime=0,t.pause()}),this.outrageAudioArray[Math.floor(Math.random()*this.outrageAudioArray.length)].play())},t}(NPC);export{Interlocutor,Wounded,Lera};