var __extends=this&&this.__extends||function(){var i=function(t,s){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,s){t.__proto__=s}:function(t,s){for(var e in s)Object.prototype.hasOwnProperty.call(s,e)&&(t[e]=s[e])}))(t,s)};return function(t,s){if("function"!=typeof s&&null!==s)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");function e(){this.constructor=t}i(t,s),t.prototype=null===s?Object.create(s):(e.prototype=s.prototype,new e)}}();import{backpack,camera,ctx,field,keys}from"../variables/variables.js";import{player}from"./player.js";import{TemplateCell}from"./template.js";var Soul=function(n){function t(t,s,e,i,a,r,o){t=n.call(this,t,s,e)||this;return t.amplitude=0,t.amplitudeSpeed=.1,t.opacity=1,t.speed=5,t.speedConst=.002,t.stage=0,t.frame=0,t.currentFrame=0,t.radius=t.size,t.startRadius=t.radius,t.condition=a,t.color=i,t.currentPositionX=camera.currentPosition.x,t.currentPositionY=camera.currentPosition.y,r&&(t.distanceFromCenter=r),!o&&0!==o||(t.radian=o),t}return __extends(t,n),t.prototype.drawStationary=function(){ctx.fillStyle=this.colorGradient,ctx.fillRect(this.x-.2*this.startRadius,this.y-.2*this.startRadius+this.amplitude,2.4*this.startRadius,2.4*this.startRadius)},t.prototype.drawInCircle=function(t,s){for(;0<this.opacity&&1.1<this.startRadius;)this.colorGradient=ctx.createRadialGradient(this.x+this.startRadius,this.y+this.startRadius,this.radius/2,this.x+this.startRadius,this.y+this.startRadius,1.2*this.radius),this.colorGradient.addColorStop(.8,"rgb(".concat(this.color,", ").concat(this.opacity,")")),this.colorGradient.addColorStop(1,"rgba(".concat(this.color,", 0)")),ctx.fillStyle=this.colorGradient,ctx.fillRect(this.x-2*this.startRadius,this.y-2*this.startRadius,6*this.radius,6*this.radius),this.opacity-=.05,1.1<this.radius&&--this.radius,this.radian-=this.speedConst,this.x=t-this.startRadius,this.y=s-this.startRadius,this.x+=Math.cos(this.radian)*this.distanceFromCenter,this.y+=Math.sin(this.radian)*this.distanceFromCenter;this.opacity=1,this.radian=this.startRadian,this.radius=this.startRadius},t.prototype.changePositions=function(t,s){switch(this.condition){case"stationary":0===player.numberOfCompletedFrames&&(this.frame=0),this.x+=this.currentPositionX-camera.currentPosition.x,this.y+=this.currentPositionY-camera.currentPosition.y,this.currentPositionX=camera.currentPosition.x,this.currentPositionY=camera.currentPosition.y,0===this.frame?(this.amplitude+=this.amplitudeSpeed,12<=this.amplitude&&(this.frame=1)):(this.amplitude-=this.amplitudeSpeed,this.amplitude<=0&&(this.frame=0)),this.colorGradient=ctx.createRadialGradient(this.x+this.startRadius,this.y+this.startRadius+this.amplitude,this.radius/2,this.x+this.startRadius,this.y+this.startRadius+this.amplitude,1.2*this.radius),this.colorGradient.addColorStop(.8,"rgb(".concat(this.color,", ").concat(this.opacity,")")),this.colorGradient.addColorStop(1,"rgba(".concat(this.color,", 0)")),this.drawStationary();break;case"circle":switch(this.stage){case 0:this.speedConst=.002;break;case 1:this.speedConst<.01&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=2e-4),this.distanceFromCenter-=.2;break;case 2:this.speedConst<.02&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=4e-4),this.distanceFromCenter-=.2;break;case 3:.01<this.speedConst&&player.numberOfCompletedFrames%6==0&&(this.speedConst-=4e-4),this.distanceFromCenter>1.3*this.radius&&(this.distanceFromCenter-=.2);break;case 4:.004<this.speedConst&&player.numberOfCompletedFrames%6==0&&(this.speedConst-=2e-4);break;case 5:this.speedConst<.01&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=2e-4);break;case 6:this.speedConst<.02&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=2e-4),this.distanceFromCenter-=.4;break;case 7:this.speedConst<.03&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=2e-4),--this.distanceFromCenter;break;case 8:.01<this.speedConst&&player.numberOfCompletedFrames%6==0&&(this.speedConst-=4e-4),this.distanceFromCenter-=.2;break;case 10:this.speedConst<.03&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=2e-4),this.distanceFromCenter<200&&(this.distanceFromCenter+=1);break;case 11:.01<this.speedConst&&player.numberOfCompletedFrames%6==0&&(this.speedConst-=4e-4),this.distanceFromCenter<1.3*this.startRadius&&(this.distanceFromCenter+=.1);break;case 12:this.speedConst<.1&&player.numberOfCompletedFrames%6==0&&(this.speedConst+=2e-4),this.distanceFromCenter>1.3*this.startRadius&&(this.distanceFromCenter-=.05);break;case 13:.01<this.speedConst&&player.numberOfCompletedFrames%6==0&&(this.speedConst-=4e-4),this.distanceFromCenter>1.1*this.startRadius&&(this.distanceFromCenter-=.04),this.startRadius-=.02}this.x=t-this.startRadius,this.y=s-this.startRadius,this.radian+=this.speedConst,this.startRadian=this.radian,this.x+=Math.cos(this.startRadian)*this.distanceFromCenter,this.y+=Math.sin(this.startRadian)*this.distanceFromCenter,this.drawInCircle(t,s)}},t.prototype.showHint=function(){keys.f.pause||(ctx.fillStyle="rgba(0,0,0,.5)",ctx.fillRect(this.x-3*this.radius,this.y-1.5*this.radius,8*this.radius,this.radius),ctx.fillStyle="white",ctx.font="900 ".concat(field.sizeCell/13,"px Pixel Art"),ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillText('жмякни "а"',this.x+this.radius,this.y-this.radius))},t.prototype.startDialog=function(){!keys.f.pressed||keys.f.pause||backpack.classList.contains("backpack_active")||(keys.f.pause=!0,player.thinks=!0,player.playerTasks.completedDialogues.soulKolya=!0)},t}(TemplateCell);export{Soul};