var __extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}}();import{camera,canvas,formQuestion,ctx,field,mapObjects,keys}from"../variables/variables.js";import{player}from"./player.js";import{objAudio}from"../variables/list-audio.js";import{TemplateCell}from"./template.js";import{arrayQuestions}from"../variables/list-questions.js";var UniversityInFlesh=function(r){function t(t,e,s,i){t=r.call(this,t,e,s)||this;return t.stageOfFight="none",t.previousStageOfFight="none",t.stageOfKeyPhrase=0,t.phrases={keyPhrases:objAudio.UniversityInFlesh.keyPhrases,questions:objAudio.UniversityInFlesh.questions,verdict:objAudio.UniversityInFlesh.verdict,transitions:objAudio.UniversityInFlesh.transitions,another:objAudio.UniversityInFlesh.another},t.arrayQuestions=arrayQuestions,t.lastTransitions=-1,t.image=new Image,t.frame=0,t.numberOfFrames=12,t.numberOfLives=5,t.maxLives=5,t.width=t.size,t.height=i,t.image.src="./images/university_in_flesh/university-in-flesh.png",t.currentPositionX=camera.currentPosition.x,t.currentPositionY=camera.currentPosition.y,t}return __extends(t,r),t.prototype.drawStationaryState=function(){ctx.drawImage(this.image,600*this.frame+1,0,599,799,this.x,this.y,this.width,this.height)},t.prototype.changePositions=function(){this.x+=this.currentPositionX-camera.currentPosition.x,this.y+=this.currentPositionY-camera.currentPosition.y,this.drawStationaryState(),player.numberOfCompletedFrames%14==0&&this.frame++,this.frame>=this.numberOfFrames&&(this.frame=0),this.nextAction()},t.prototype.nextAction=function(){var t=this;switch(this.stageOfFight){case"key phrases":this.stageOfFight="none",setTimeout(function(){t.previousStageOfFight="key phrases",t.phrases.keyPhrases[t.stageOfKeyPhrase].play(),t.phrases.keyPhrases[t.stageOfKeyPhrase].addEventListener("ended",t.finalKeyPhrases)},1e3);break;case"questions":this.stageOfFight="none",this.previousStageOfFight="questions",setTimeout(function(){t.selectQuestion()},1e3);break;case"verdict":this.stageOfFight="none",this.previousStageOfFight="verdict",(this.answer?(this.numberOfLives--,this.stageOfVerdict=Math.floor(Math.random()*this.phrases.verdict.yes.length),this.phrases.verdict.yes[this.stageOfVerdict].play(),this.phrases.verdict.yes):(this.stageOfVerdict=Math.floor(Math.random()*this.phrases.verdict.no.length),this.phrases.verdict.no[this.stageOfVerdict].play(),this.phrases.verdict.no))[this.stageOfVerdict].addEventListener("ended",function(){t.afterVerdict()},{once:!0});break;case"transitions":this.stageOfFight="none",setTimeout(function(){for(t.previousStageOfFight="transitions",t.stageOfTransition=Math.floor(Math.random()*t.phrases.transitions.length);t.stageOfTransition===t.lastTransitions;)t.stageOfTransition=Math.floor(Math.random()*t.phrases.transitions.length);t.lastTransitions=t.stageOfTransition,t.phrases.transitions[t.stageOfTransition].play(),t.phrases.transitions[t.stageOfTransition].addEventListener("ended",t.finalTransition)},1e3)}},t.prototype.finalTransition=function(){this.stageOfFight="questions"},t.prototype.finalKeyPhrases=function(){switch(mapObjects.UniversityInFlesh[0].stageOfKeyPhrase){case 0:mapObjects.UniversityInFlesh[0].stageOfFight="questions";break;case 1:mapObjects.UniversityInFlesh[0].stageOfFight="victory",player.bossFightStage=!1;break;case 2:mapObjects.UniversityInFlesh[0].stageOfFight="defeat",player.bossFightStage=!1,player.numberOfDeaths++}},t.prototype.selectQuestion=function(){var t=this;this.currentQuestion=Math.floor(Math.random()*this.phrases.questions.length),this.phrases.questions[this.currentQuestion].play(),this.phrases.questions[this.currentQuestion].addEventListener("ended",function(){formQuestion.children[0].children[0].innerHTML=t.arrayQuestions[t.currentQuestion].question,formQuestion.classList.add("university-form_active")})},t.prototype.checkAnswer=function(t){formQuestion.classList.remove("university-form_active"),null!==t.replace(/\s/g,"").toLowerCase().match(this.arrayQuestions[this.currentQuestion].answer)?this.answer=!0:this.answer=!1,this.stageOfFight="verdict",this.phrases.questions.splice(this.currentQuestion,1),this.arrayQuestions.splice(this.currentQuestion,1)},t.prototype.afterVerdict=function(){0===this.numberOfLives?(this.stageOfKeyPhrase=1,this.stageOfFight="key phrases"):0<this.numberOfLives&&0===this.arrayQuestions.length||this.numberOfLives>this.arrayQuestions.length?(this.stageOfKeyPhrase=2,this.stageOfFight="key phrases"):this.stageOfFight="transitions"},t.prototype.showSkipText=function(){ctx.fillStyle="white",ctx.font="900 ".concat(field.sizeCell/13,"px Pixel Art"),ctx.textBaseline="middle",ctx.textAlign="center",ctx.fillText('Жмякни "а", чтобы пропустить',canvas.width/2,canvas.height-.2*field.sizeCell),keys.f.pressed&&("transitions"===this.previousStageOfFight?(this.phrases.transitions[this.stageOfTransition].currentTime=0,this.phrases.transitions[this.stageOfTransition].pause(),this.phrases.transitions[this.stageOfTransition].removeEventListener("ended",this.finalTransition)):"key phrases"===this.previousStageOfFight&&(this.phrases.keyPhrases[this.stageOfKeyPhrase].currentTime=0,this.phrases.keyPhrases[this.stageOfKeyPhrase].pause(),this.phrases.keyPhrases[this.stageOfKeyPhrase].removeEventListener("ended",this.finalKeyPhrases)),this.stageOfFight="questions",keys.f.pressed=!1)},t}(TemplateCell);export{UniversityInFlesh};