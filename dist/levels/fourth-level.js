import{Player,player}from"../classes/player.js";import{backpackButton,blackout,camera,canvas,ctx,halfCanvas,keys,level,mapObjects}from"../variables/variables.js";import{objAudio}from"../variables/list-audio.js";import{behindDetector,collisionOfGameObjects,collisionWithPlayer,interaction,takingDamage}from"../common/interaction-with-environment.js";import{changePositions,renderingCountItems,adaptGameField,levelGeneration}from"../common/level-generation.js";import{movingToNextLevel}from"../common/next-level.js";import{renderingFifthLevel}from"./fifth-level.js";function renderingFourthLevel(){player.animationId=requestAnimationFrame(renderingFourthLevel),4e3<canvas.width?ctx.clearRect(camera.beginningMap.x-2e3,camera.beginningMap.y-2e3,Math.abs(camera.beginningMap.x)+Math.abs(camera.edgeOfMap.x)+4e3,Math.abs(camera.beginningMap.y)+Math.abs(camera.edgeOfMap.y)+4e3):ctx.clearRect(camera.beginningMap.x-1e3,camera.beginningMap.y-1e3,Math.abs(camera.beginningMap.x)+Math.abs(camera.edgeOfMap.x)+2e3,Math.abs(camera.beginningMap.y)+Math.abs(camera.edgeOfMap.y)+2e3),0===player.numberOfCompletedFrames&&backpackButton.classList.remove("backpack-button_not_active"),0!==player.numberOfCompletedFrames&&player.numberOfCompletedFrames%5400!=0||(objAudio.soundsOfLocations[3].currentTime=0,objAudio.soundsOfLocations[3].play()),keys.a.pressed&&player.x>mapObjects.edge[0].x&&!player.thinks&&(collisionWithPlayer("tablet",{x:-Player.speed,y:0}),player.permissionMovement&&collisionWithPlayer("tree",{x:-Player.speed,y:0}),player.permissionMovement&&collisionWithPlayer("wall",{x:-Player.speed,y:0}),player.permissionMovement&&collisionWithPlayer("water",{x:-Player.speed,y:0}),player.x+player.width/2>halfCanvas.w+Player.speed||camera.currentPosition.x<=halfCanvas.w-Player.speed?player.permissionMovement?player.speedX=-Player.speed:player.speedX=0:player.permissionMovement&&(camera.currentPosition.x-=Player.speed),player.permissionMovement?player.audio.walkingLawn.play():player.permissionMovement=!0),keys.d.pressed&&player.x+player.width<mapObjects.edge[1].x+mapObjects.edge[1].size&&!player.thinks&&(collisionWithPlayer("tablet",{x:Player.speed,y:0}),player.permissionMovement&&collisionWithPlayer("tree",{x:Player.speed,y:0}),player.permissionMovement&&collisionWithPlayer("wall",{x:Player.speed,y:0}),player.permissionMovement&&collisionWithPlayer("water",{x:Player.speed,y:0}),player.x+player.width/2<halfCanvas.w+Player.speed||camera.currentPosition.x>=camera.edgeOfMap.startX-halfCanvas.w-Player.speed?player.permissionMovement?player.speedX=Player.speed:player.speedX=0:player.permissionMovement&&(camera.currentPosition.x+=Player.speed),player.permissionMovement?player.audio.walkingLawn.play():player.permissionMovement=!0),keys.w.pressed&&player.y>Player.speed&&!player.thinks&&(collisionWithPlayer("tablet",{x:0,y:-Player.speed}),player.permissionMovement&&collisionWithPlayer("tree",{x:0,y:-Player.speed}),player.permissionMovement&&collisionWithPlayer("wall",{x:0,y:-Player.speed}),player.permissionMovement&&collisionWithPlayer("water",{x:0,y:-Player.speed}),player.y+player.height/2>halfCanvas.h||camera.currentPosition.y<=halfCanvas.h?player.permissionMovement?player.speedY=-Player.speed:player.speedY=0:player.permissionMovement&&(camera.currentPosition.y-=Player.speed),player.permissionMovement?player.audio.walkingLawn.play():player.permissionMovement=!0),keys.s.pressed&&player.y+player.height<canvas.height-Player.speed&&!player.thinks&&(collisionWithPlayer("tablet",{x:0,y:Player.speed}),player.permissionMovement&&collisionWithPlayer("tree",{x:0,y:Player.speed}),player.permissionMovement&&collisionWithPlayer("wall",{x:0,y:Player.speed}),player.permissionMovement&&collisionWithPlayer("water",{x:0,y:Player.speed}),player.y+player.height/2<halfCanvas.h||camera.currentPosition.y>=camera.edgeOfMap.startY-halfCanvas.h?player.permissionMovement?player.speedY=Player.speed:player.speedY=0:player.permissionMovement&&(camera.currentPosition.y+=Player.speed),player.permissionMovement?player.audio.walkingLawn.play():player.permissionMovement=!0),changePositions(),mapObjects.edge.forEach(function(e){e.changePositions()}),mapObjects.endLevel.changePositions(),mapObjects.target.forEach(function(e){e.changePositions()}),mapObjects.water.forEach(function(e){e.changePositions()}),mapObjects.floor.forEach(function(e){e.changePositions()}),mapObjects.decor.forEach(function(e){e.changePositions()}),mapObjects.item.forEach(function(e){e.changePositions()}),mapObjects.tablet.forEach(function(e){e.changePositions()}),mapObjects.tree.forEach(function(e){e.changePositions()}),mapObjects.bullet.forEach(function(e){e.changePositions()}),collisionOfGameObjects("bullet","window"),collisionOfGameObjects("bullet","tree"),mapObjects.wall.forEach(function(e){e.changePositions()}),player.movementPlayer(),player.numberOfCompletedFrames++,behindDetector("item"),behindDetector("tree"),behindDetector("tablet"),behindDetector("wall"),interaction("item"),interaction("tablet"),takingDamage("bullet"),renderingCountItems(),player.numberOfLives<=0&&(blackout.classList.remove("blackout_behind-canvas"),blackout.classList.add("blackout_active"),objAudio.soundsOfLocations[3].currentTime=0,objAudio.soundsOfLocations[3].pause(),cancelAnimationFrame(player.animationId),removeEventListener("resize",adaptGameField),player.numberOfDeaths++,player.numberOfCompletedFrames=0,player.numberOfLives=100,objAudio.effects[1].play(),setTimeout(function(){blackout.classList.add("blackout_behind-canvas"),blackout.classList.remove("blackout_active"),levelGeneration(17,29),renderingFourthLevel()},4e3)),player.x+player.width>=mapObjects.endLevel.x&&player.x<=mapObjects.endLevel.x+mapObjects.endLevel.size&&player.y+player.height>=mapObjects.endLevel.y&&player.y+player.height<=mapObjects.endLevel.y+mapObjects.endLevel.size&&(objAudio.soundsOfLocations[3].currentTime=0,objAudio.soundsOfLocations[3].pause(),level.currentLevel=5,player.debuffSpeed=1,movingToNextLevel(renderingFifthLevel,"long","Lawn Of Lera",7,5))}export{renderingFourthLevel};